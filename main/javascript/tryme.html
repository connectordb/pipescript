<!DOCTYPE html>
<html lang="en">

	<head>

		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="">
		<meta name="author" content="">

		<title>PipeScript</title>

		<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
		<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.11.0/codemirror.min.css" rel="stylesheet">

		<!-- Custom CSS -->
		<style>
			/*!
			 * Start Bootstrap - Scrolling Nav HTML Template (http://startbootstrap.com)
			 * Code licensed under the Apache License v2.0.
			 * For details, see http://www.apache.org/licenses/LICENSE-2.0.
			 */

			body {
				width: 100%;
				height: 100%;
			}

			html {
				width: 100%;
				height: 100%;
			}

			@media(min-width:767px) {
				.navbar {
					padding: 20px 0;
					-webkit-transition: background .5s ease-in-out, padding .5s ease-in-out;
					-moz-transition: background .5s ease-in-out, padding .5s ease-in-out;
					transition: background .5s ease-in-out, padding .5s ease-in-out;
				}
				.top-nav-collapse {
					padding: 0;
				}
			}
			/* Demo Sections - You can use these as guides or delete them - the scroller will work with any sort of height, fixed, undefined, or percentage based.
The padding is very important to make sure the scrollspy picks up the right area when scrolled to. Adjust the margin and padding of sections and children
of those sections to manage the look and feel of the site. */

			.try-section {
				padding-top: 150px;
				background: #fff;
				padding-bottom: 30px;
			}

			.transforms-section {
				padding-top: 35px;
				text-align: center;
				background: #eee;
			}

		</style>


		<style type="text/css">
			.CodeMirror {
				border: 1px solid black;
			}

			.docs {
				text-align: left;
				background: #fff;
				padding: 10px;
			}

		</style>

		<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

	</head>

	<!-- The #page-top ID is part of the scrolling feature - the data-spy and data-target are part of the built-in Bootstrap scrollspy function -->

	<body id="page-top" data-spy="scroll" data-target=".navbar-fixed-top">

		<!-- Navigation -->
		<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
			<div class="container">
				<div class="navbar-header page-scroll">
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<a class="navbar-brand page-scroll" href="#page-top">PipeScript</a>
				</div>

				<!-- Collect the nav links, forms, and other content for toggling -->
				<div class="collapse navbar-collapse navbar-ex1-collapse">
					<ul class="nav navbar-nav">
						<!-- Hidden li included to remove active class from about link when scrolled up past about section -->
						<li class="hidden">
							<a class="page-scroll" href="#page-top"></a>
						</li>
						<li>
							<a class="page-scroll" href="#transforms">Transforms</a>
						</li>
						<li>
							<a class="page-scroll" href="https://connectordb.github.io/pipescript">Tutorial</a>
						</li>
						<li>
							<a class="page-scroll" href="https://github.com/connectordb/pipescript">Github</a>
						</li>
					</ul>
				</div>
				<!-- /.navbar-collapse -->
			</div>
			<!-- /.container -->
		</nav>

		<!-- jQuery -->
		<script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
		<!-- Bootstrap Core JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

		<!-- Scrolling Nav JavaScript -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
		<script type="text/javascript">
			/* Taken from the template used*/
			//jQuery to collapse the navbar on scroll
			$(window).scroll(function() {
				if ($(".navbar").offset().top > 50) {
					$(".navbar-fixed-top").addClass("top-nav-collapse");
				} else {
					$(".navbar-fixed-top").removeClass("top-nav-collapse");
				}
			});

			//jQuery for page scrolling feature - requires jQuery Easing plugin
			$(function() {
				$('a.page-scroll').bind('click', function(event) {
					var $anchor = $(this);
					$('html, body').stop().animate({
						scrollTop: $($anchor.attr('href')).offset().top
					}, 1500, 'easeInOutExpo');
					event.preventDefault();
				});
			});

		</script>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.11.0/codemirror.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.11.0/mode/javascript/javascript.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.11.0/addon/edit/matchbrackets.min.js"></script>

		<!-- Intro Section: Try PipeScript in your browser-->
		<section id="intro" class="try-section">
			<div class="container">

				<div class="row">
					<div class="col-lg-12" style="text-align: center;padding-bottom:12px;">
						<h1>Try PipeScript</h1>
						<p>Run PipeScript right in your browser.</p>
					</div>
				</div>
				<div class="row">
					<div class="col-md-8" style="margin-bottom: 10px;">
						<form>
							<div class="input-group">
								<input type="text" class="form-control" id="script" style="font-family:monospace;font-size: 150%;" value="map($['activity'],$['steps']:sum)">
								<span class="input-group-btn">
								<input type="submit" class="btn btn-default" id="scriptbtn" type="button">Go!</button>
							</span>
							</div>
						</form>
						<!-- /input-group -->
					</div>
					<div class="col-md-4" style="text-align: center;">
							<label class="radio-inline">
								<input type="radio" name="optradio" value="dp" onchange="setdp();" checked>Datapoint</label>

							<label class="radio-inline">
								<input type="radio" name="optradio" onchange="setcsv();" value="csv">CSV</label>

							<label class="radio-inline">
								<input type="radio" name="optradio" onclick="setjson();" value="json">JSON</label>

					</div>
					<script>
						function setdp() {
							input.setValue(`[
  {
    "t": 145417065,
    "d": {
      "steps": 14,
      "activity": "walking"
    }
  },
  {
    "t": 145511065,
    "d": {
      "steps": 10,
      "activity": "running"
    }
  },
  {
    "t": 145513065,
    "d": {
      "steps": 12,
      "activity": "walking"
    }
  },
  {
    "t": 145517065,
    "d": {
      "steps": 5,
      "activity": "running"
    }
  }
]`);
						}
						function setjson() {
							input.setValue(`[
  {
    "t": "1974-08-11T01:37:45+00:00",
    "steps": 14,
    "activity": "walking"
},
  {
    "t": "1974-08-12T03:44:25+00:00",
    "steps": 10,
    "activity": "running"
},
  {
    "t": "1974-08-12T04:17:45+00:00",
    "steps": 12,
    "activity": "walking"
},
  {
    "t": "1974-08-12T05:24:25+00:00",
    "steps": 5,
    "activity": "running"
}]`);
						runScript();
						}
						function setcsv() {
							input.setValue('time,steps,activity\n\
1974-08-11T01:37:45+00:00,14,walking\n\
1974-08-12T03:44:25+00:00,10,running\n\
1974-08-12T04:17:45+00:00, 12,walking\n\
1974-08-12T05:24:25+00:00,5,running');
							runScript();
						}
					</script>
				</div>
				<div class="row">
					<div class="col-md-6">
						<textarea id="input"></textarea>
					</div>
					<div class="col-md-6">
						<textarea id="output"></textarea>
					</div>
				</div>
				<script>
					var input = CodeMirror.fromTextArea(document.getElementById("input"), {
						matchBrackets: true,
						autoCloseBrackets: true,
						mode: "application/json",
						lineWrapping: true
					});
					var output = CodeMirror.fromTextArea(document.getElementById("output"), {
						matchBrackets: true,
						autoCloseBrackets: true,
						mode: "application/json",
						lineWrapping: true,
						readOnly: true
					});

					input.setValue(JSON.stringify(JSON.parse(
						'[{"t": 1,"d": {"steps": 14,"activity": "walking"}},\
					{"t": 2,"d": { "steps": 10,"activity": "running"}},\
					{"t": 3,"d": {"steps": 12,"activity": "walking"}},\
					{"t": 4,"d": {"steps": 5,"activity": "running"}}]'), null, 2));

					output.setValue("Loading PipeScript...");

				</script>


			</div>
		</section>


		<!-- About Section -->
		<section id="transforms" class="transforms-section">
			<div class="container">
				<div class="row">
					<div class="col-lg-12">
						<h1>Transforms</h1>
						<div id="searchable">

							<input class="search search-query form-control" type="text" placeholder="Search" />
							<br />
							<table class="table table-striped table-bordered" id="ftable">
								<thead>
									<th>Name</th>
									<th>Description</th>
									<th>Arguments</th>
								</thead>
								<!-- IMPORTANT, class="list" have to be at tbody -->
								<tbody class="list">

								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</section>

		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.1.1/list.min.js"></script>
		<script type="text/javascript" src="https://cdn.rawgit.com/showdownjs/showdown/1.4.2/dist/showdown.min.js"></script>
		<script type="text/javascript" src="pipescript.js"></script>
		<script>
			function runScript() {
				output.setValue("Running...");
				s = pipescript.script($("#script").val());
				if (!s.IsValid()) {
					output.setValue(s.Error());
				}
				result = s.Run(input.getValue(),$("input[name=optradio]:checked").val());
				if (!s.IsValid()) {
					output.setValue(s.Error());
				} else {
					output.setValue(result);
				}
			}

			runScript();

			$("#scriptbtn").click(function(e) {
				e.preventDefault();
				runScript();
			});

			var converter = new showdown.Converter();


			// Now set up the transform list
			data = pipescript.transforms

			// http://stackoverflow.com/questions/684672/loop-through-javascript-object
			for (var key in data) {
				if (data.hasOwnProperty(key)) {
					console.log(key);
					var v = data[key];

					var fdata = "<tr><td class='fname'>" + key + "</td><td class='fdesc'>" + v.Description + "<br/><div class='docs'>"+ converter.makeHtml(v.Documentation)+"</div></td><td class='farg'><ol>";
					for (d in v.Args) {
						var cv = v.Args[d];
						fdata += "<li>";
						if (cv.Optional) {
							fdata += "<i>(optional)</i> - ";
						}
						fdata += cv.Description + "</li>";
					}
					fdata += "</ol>";


					$('#ftable tbody').append(fdata);
				}
			}

			//Set up the search box
			var options = {
				valueNames: ["fname", "fdesc", "farg"]
			};
			var flist = new List("searchable", options);

		</script>
		<footer class="site-footer">
			<div class="container text-center">
				Copyright 2016 the <a href="github.com/connectordb/pipescript">PipeScript Contributors</a>
				</small>
			</div>
		</footer>
	</body>

</html>
